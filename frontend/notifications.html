<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - Bookstore</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f8f8f8; }
        header { background: #8d31f5; color: #fff; padding: 20px 0; text-align: center; }
        nav { background: #541998; padding: 10px 0; text-align: center; }
        nav a { color: #fff; margin: 0 15px; text-decoration: none; font-weight: bold; }
        .container { max-width: 800px; margin: 30px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        h2 { margin-top: 0; }
        .notification-section { margin-bottom: 36px; }
        .notification-list { list-style: none; padding: 0; margin: 0; }
        .notification-list li { background: #f2f2f2; border-left: 5px solid #8d31f5; margin-bottom: 12px; padding: 14px 18px; border-radius: 4px; color: #333; }
        .notification-list .order { border-left-color: #31b0f5; }
        .notification-list .system { border-left-color: #f5a631; }
        .notification-list .low-inventory { border-left-color: #d9534f; }
        .notification-list .low-inventory.critical { border-left-color: #dc3545; background: #f8d7da; }
        .notification-list .low-inventory.warning { border-left-color: #ffc107; background: #fff3cd; }
        .empty-msg { color: #888; font-style: italic; margin: 10px 0 0 0; }
        .refresh-btn { 
            background: #8d31f5; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-bottom: 15px; 
            font-size: 0.9em;
        }
        .refresh-btn:hover { background: #541998; }
        .clear-btn { 
            background: #6c757d; 
            color: white; 
            border: none; 
            padding: 6px 12px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-left: 10px; 
            font-size: 0.8em;
        }
        .clear-btn:hover { background: #545b62; }
        .notification-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Notifications</h1>
    </header>
    <nav>
        <a href="inventory.html">Inventory</a>
        <a href="sales.html">Sales History</a>
    
        <a href="#" onclick="logout()">Logout</a></nav>
    <div class="container">
        <div class="notification-section">
            <h2>Order Notifications</h2>
            <ul class="notification-list" id="orderNotifications"></ul>
            <div class="empty-msg" id="orderEmpty">No order notifications.</div>
        </div>
        <div class="notification-section">
            <h2>System Notifications</h2>
            <ul class="notification-list" id="systemNotifications"></ul>
            <div class="empty-msg" id="systemEmpty">No system notifications.</div>
        </div>
        <div class="notification-section">
            <div class="notification-header">
                <h2>Low Inventory Notifications</h2>
                <div>
                    <button class="refresh-btn" onclick="refreshLowInventoryNotifications()">Refresh</button>
                    <button class="clear-btn" onclick="clearLowInventoryNotifications()">Clear All</button>
                </div>
            </div>
            <ul class="notification-list" id="lowInventoryNotifications"></ul>
            <div class="empty-msg" id="lowInventoryEmpty">No low inventory notifications.</div>
        </div>
    </div>
    <script>
        // Example notification data (replace with backend fetch in production)
        const orderNotifications = [
            { message: "Order #1234 has shipped.", date: "2025-09-12" },
            { message: "Order #1235 is being processed.", date: "2025-09-12" }
        ];
        const systemNotifications = [
            { message: "System maintenance scheduled for Sept 15, 2025.", date: "2025-09-10" }
        ];

        // Load real low inventory notifications from localStorage
        function loadLowInventoryNotifications() {
            const stored = localStorage.getItem('lowStockNotifications');
            if (!stored) return [];
            
            try {
                const notifications = JSON.parse(stored);
                // Filter to show only recent notifications (last 7 days)
                const sevenDaysAgo = new Date();
                sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                
                return notifications
                    .filter(notif => new Date(notif.date) >= sevenDaysAgo)
                    .sort((a, b) => new Date(b.date) - new Date(a.date)); // Most recent first
            } catch (e) {
                console.error('Error loading low stock notifications:', e);
                return [];
            }
        }

        function renderNotifications(list, elementId, emptyId, type) {
            const ul = document.getElementById(elementId);
            const emptyMsg = document.getElementById(emptyId);
            ul.innerHTML = '';
            if (list.length === 0) {
                emptyMsg.style.display = '';
                return;
            }
            emptyMsg.style.display = 'none';
            list.forEach(n => {
                const li = document.createElement('li');
                li.classList.add(type);
                li.innerHTML = `<strong>${n.date}:</strong> ${n.message}`;
                ul.appendChild(li);
            });
        }

        function renderLowInventoryNotifications(list) {
            const ul = document.getElementById('lowInventoryNotifications');
            const emptyMsg = document.getElementById('lowInventoryEmpty');
            ul.innerHTML = '';
            
            if (list.length === 0) {
                emptyMsg.style.display = '';
                return;
            }
            
            emptyMsg.style.display = 'none';
            
            list.forEach(notification => {
                const li = document.createElement('li');
                li.classList.add('low-inventory');
                
                // Add specific styling based on alert level
                if (notification.level === 'critical') {
                    li.classList.add('critical');
                } else if (notification.level === 'warning') {
                    li.classList.add('warning');
                }
                
                // Format the date nicely
                const date = new Date(notification.date);
                const formattedDate = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                // Add time if notification is from today
                const today = new Date().toDateString();
                const notifDay = date.toDateString();
                let timeDisplay = '';
                
                if (today === notifDay) {
                    timeDisplay = ` at ${date.toLocaleTimeString('en-US', {
                        hour: 'numeric',
                        minute: '2-digit',
                        hour12: true
                    })}`;
                }
                
                li.innerHTML = `
                    <div>
                        <strong>${formattedDate}${timeDisplay}:</strong> ${notification.message}
                    </div>
                    <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                        Current Stock: ${notification.stock} items | Alert Level: ${notification.level.toUpperCase()}
                    </div>
                `;
                ul.appendChild(li);
            });
        }

        // Function to refresh low inventory notifications
        function refreshLowInventoryNotifications() {
            const notifications = loadLowInventoryNotifications();
            renderLowInventoryNotifications(notifications);
            
            // Show feedback
            const refreshBtn = document.querySelector('.refresh-btn');
            const originalText = refreshBtn.textContent;
            refreshBtn.textContent = 'Refreshed!';
            refreshBtn.style.background = '#28a745';
            
            setTimeout(() => {
                refreshBtn.textContent = originalText;
                refreshBtn.style.background = '#8d31f5';
            }, 1500);
        }

        // Function to clear all low inventory notifications
        function clearLowInventoryNotifications() {
            if (confirm('Are you sure you want to clear all low inventory notifications?')) {
                localStorage.removeItem('lowStockNotifications');
                renderLowInventoryNotifications([]);
                
                // Show feedback
                const clearBtn = document.querySelector('.clear-btn');
                const originalText = clearBtn.textContent;
                clearBtn.textContent = 'Cleared!';
                clearBtn.style.background = '#28a745';
                
                setTimeout(() => {
                    clearBtn.textContent = originalText;
                    clearBtn.style.background = '#6c757d';
                }, 1500);
            }
        }

        // Initial render
        renderNotifications(orderNotifications, 'orderNotifications', 'orderEmpty', 'order');
        renderNotifications(systemNotifications, 'systemNotifications', 'systemEmpty', 'system');
        
        // Load and render low inventory notifications
        const lowInventoryNotifications = loadLowInventoryNotifications();
        renderLowInventoryNotifications(lowInventoryNotifications);
        
        // Auto-refresh notifications every 30 seconds
        setInterval(() => {
            const notifications = loadLowInventoryNotifications();
            renderLowInventoryNotifications(notifications);
        }, 30000);
    </script>
<script>
function logout() { try { localStorage.removeItem('jwt'); } catch(e) {} window.location.href = 'index.html'; }
</script>
</body>
</html>
